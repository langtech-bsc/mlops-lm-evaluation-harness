import datasets
import yaml

QUESTION = {
    'ar': 'سؤال',
    'bn': 'প্রশ্ন',
    'de': 'Frage',
    'es': 'Pregunta',
    'fr': 'Question',
    'hi': 'प्रश्न',
    'id': 'Pertanyaan',
    'it': 'Domanda',
    'ja': '質問',
    'ko': '질문',
    'pt': 'Pergunta',
    'sw': 'Swali',
    'yo': 'Ìbéèrè',
    'zh': '问题'
}

ANSWER = {
    'ar': 'إجابة',
    'bn': 'উত্তর',
    'de': 'Antwort',
    'es': 'Respuesta',
    'fr': 'Réponse',
    'hi': 'उत्तर',
    'id': 'Jawaban',
    'it': 'Risposta',
    'ja': '回答',
    'ko': '답변',
    'pt': 'Resposta',
    'sw': 'Jibu',
    'yo': 'Ìdáhùn',
    'zh': '答案'
}

OPTIONS = {
    'ar': 'خيارات',
    'bn': 'বিকল্পগুলি',
    'de': 'Optionen',
    'es': 'Opciones',
    'fr': 'Options',
    'hi': 'विकल्प',
    'id': 'Opsi',
    'it': 'Opzioni',
    'ja': '選択肢',
    'ko': '옵션',
    'pt': 'Opções',
    'sw': 'Chaguo',
    'yo': 'Àṣàyàn',
    'zh': '选项'
}

def _doc_to_text(lang: str) -> str:
    return f"{QUESTION[lang]}: " + "{{Question.strip()}}\\n" + f"{OPTIONS[lang]}:\\n" + "A. {{A}}\\nB. {{B}}\\nC. {{C}}\\nD. {{D}}\\n" + f"{ANSWER[lang]}:"

def main() -> None:
    dataset_path = "openai/MMMLU"
    task_name = "mmmlu"

    for lang_country in datasets.get_dataset_infos(dataset_path).keys():
        if lang_country == "default":
            # skip the `default` subset
            continue

        lang = lang_country.split("_")[0].lower()
        filename = f"{task_name}_{lang}.yaml"

        with open(filename, "w") as f:
            print(f"Writing {filename}...")
            prelim_yaml = yaml.dump(
                {
                    "include": "_mmmlu_common_yaml",
                    "task": f"{task_name}_{lang}",
                    "dataset_name": lang_country,
                    "doc_to_text": _doc_to_text(lang),
                },
                allow_unicode=True,
                width=9999,
            )

            final_yaml = prelim_yaml.replace("'", '"')
            f.write(f"# Generated by _generate_configs.py\n{final_yaml}")

if __name__ == "__main__":
    main()
